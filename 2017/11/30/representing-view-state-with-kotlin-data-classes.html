<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Representing View State with Kotlin Data Classes | craigrussell</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Representing View State with Kotlin Data Classes" />
<meta name="author" content="Craig Russell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Using Kotlin data classes to represent view state" />
<meta property="og:description" content="Using Kotlin data classes to represent view state" />
<link rel="canonical" href="https://cdrussell.github.io//2017/11/30/representing-view-state-with-kotlin-data-classes" />
<meta property="og:url" content="https://cdrussell.github.io//2017/11/30/representing-view-state-with-kotlin-data-classes" />
<meta property="og:site_name" content="craigrussell" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Representing View State with Kotlin Data Classes" />
<script type="application/ld+json">
{"description":"Using Kotlin data classes to represent view state","url":"https://cdrussell.github.io//2017/11/30/representing-view-state-with-kotlin-data-classes","@type":"BlogPosting","headline":"Representing View State with Kotlin Data Classes","dateModified":"2017-11-30T00:00:00+00:00","datePublished":"2017-11-30T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cdrussell.github.io//2017/11/30/representing-view-state-with-kotlin-data-classes"},"author":{"@type":"Person","name":"Craig Russell"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <header >
        <a href='https://cdrussell.github.io//'>
          <h1>craigrussell</h1>
          
            <p>Technical blog from Craig Russell.</p>
          
        </a>

        <nav>
  <div style="
         top: 0px;
         right: 0px;
         position: absolute">

    <a href="/about">
      <figure>
        <img src="/images/me-round.png"
             style="
              height: 50px;
              display: block;
              margin-left: auto;
              margin-right: auto;
              "
             alt="Photo of me, wearing a bright yellow t-shirt with a bright blue, cloudy sky in the background"
        />
        <figcaption style="text-align:justify" >About me</figcaption>
      </figure>
    </a>
  </div>
</nav>


        <p> </p>
      </header>
      <section>

      <h1 id="representing-view-state-with-kotlin-data-classes">Representing View State with Kotlin Data Classes</h1>
<p><img src="/images/kotlin-logo.png" alt="kotlin logo" width="100%" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<p><em>This article describes how to use Kotlin’s <a href="https://kotlinlang.org/docs/reference/data-classes.html">data classes</a> to represent the view state of an <a href="https://developer.android.com/topic/libraries/architecture/index.html">Android Architectures Component</a> ViewModel</em></p>

<h2 id="background">Background</h2>
<p>Using a <a href="https://developer.android.com/topic/libraries/architecture/viewmodel.html"><code class="language-plaintext highlighter-rouge">ViewModel</code></a>, we can represent the current state of the UI and pass this to an Activity which can render it. Using this architecture, an Activity will react to changes in the view state as they happen.</p>

<p>Since this view state is typically only changed by the <code class="language-plaintext highlighter-rouge">ViewModel</code>, we can make it immutable as far as the Activity is concerned.</p>

<h2 id="representing-the-ui-state">Representing the UI State</h2>
<p>We can define the UI state as a Kotlin data class within our <code class="language-plaintext highlighter-rouge">ViewModel</code>; we take this as a convenient place to add default values for each of the fields.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">ViewState</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">isLoading</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">progress</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">isEditing</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">browserShowing</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">showClearButton</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="exposing-observable-state">Exposing observable state</h2>
<p>Once defined like this, we can expose a <a href="https://developer.android.com/topic/libraries/architecture/livedata.html">LiveData</a><ViewState> to which an Activity can observe changes.</ViewState></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">viewState</span><span class="p">:</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">ViewState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">()</span>
<span class="nf">init</span> <span class="p">{</span>
    <span class="n">viewState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">ViewState</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nf">currentViewState</span><span class="p">():</span> <span class="nc">ViewState</span> <span class="p">=</span> <span class="n">viewState</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
</code></pre></div></div>

<p>Above, we define the <code class="language-plaintext highlighter-rouge">viewState</code> value which is observable, and we push a default value to it using the <code class="language-plaintext highlighter-rouge">init</code> block. For convenience, we also define a private function that can be used in the <code class="language-plaintext highlighter-rouge">ViewModel</code> to obtain the current view state at any time.</p>

<p>Technically <code class="language-plaintext highlighter-rouge">viewState.value</code> is nullable, even though we know it won’t be since we’ve provided a default value upon creating, so this function saves the rest of the class from thinking about <code class="language-plaintext highlighter-rouge">viewState.value</code> from ever being null. We need to use the ugly <code class="language-plaintext highlighter-rouge">!!</code> syntax here, but it’s isolated to this one function and saves the rest of the view model from needing to handle nulls.</p>

<h2 id="observing-ui-changes">Observing UI Changes</h2>
<p>In the Activity we can subscribe to observing any changes to this view state.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
  <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
  <span class="nf">setContentView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_browser</span><span class="p">)</span>
  
  <span class="n">viewModel</span><span class="p">.</span><span class="n">viewState</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">Observer</span><span class="p">&lt;</span><span class="nc">BrowserViewModel</span><span class="err">.</span><span class="nc">ViewState</span><span class="p">&gt;</span> <span class="p">{</span>
      <span class="n">it</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="nf">render</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nf">render</span><span class="p">(</span><span class="n">viewState</span><span class="p">:</span> <span class="nc">BrowserViewModel</span><span class="p">.</span><span class="nc">ViewState</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">when</span> <span class="p">(</span><span class="n">viewState</span><span class="p">.</span><span class="n">browserShowing</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">webView</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
      <span class="k">false</span> <span class="p">-&gt;</span> <span class="n">webView</span><span class="p">.</span><span class="nf">hide</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">when</span> <span class="p">(</span><span class="n">viewState</span><span class="p">.</span><span class="n">isLoading</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">true</span> <span class="p">-&gt;</span> <span class="n">pageLoadingIndicator</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
      <span class="k">false</span> <span class="p">-&gt;</span> <span class="n">pageLoadingIndicator</span><span class="p">.</span><span class="nf">hide</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">when</span> <span class="p">(</span><span class="n">viewState</span><span class="p">.</span><span class="n">showClearButton</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">true</span> <span class="p">-&gt;</span> <span class="nf">showClearButton</span><span class="p">()</span>
      <span class="k">false</span> <span class="p">-&gt;</span> <span class="nf">hideClearButton</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="n">pageLoadingIndicator</span><span class="p">.</span><span class="n">progress</span> <span class="p">=</span> <span class="n">viewState</span><span class="p">.</span><span class="n">progress</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Every time a change is pushed from the <code class="language-plaintext highlighter-rouge">ViewModel</code>, our Activity immediately gets notified, and renders the UI accordingly.</p>

<h2 id="making-changes-to-the-ui-state">Making changes to the UI state</h2>
<p>So how do changes to the view state happen? Since we’ve defined the view state as being immutable, how do we change anything?</p>

<p>When the <code class="language-plaintext highlighter-rouge">ViewModel</code> wants to make a change that the Activity will render, it copies the existing view state and changes only the values it needs to, preserving the existing values for the other fields.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="k">fun</span> <span class="nf">progressChanged</span><span class="p">(</span><span class="n">newProgress</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">viewState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nf">currentViewState</span><span class="p">().</span><span class="nf">copy</span><span class="p">(</span><span class="n">progress</span> <span class="p">=</span> <span class="n">newProgress</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">override</span> <span class="k">fun</span> <span class="nf">loadingStarted</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">viewState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nf">currentViewState</span><span class="p">().</span><span class="nf">copy</span><span class="p">(</span><span class="n">isLoading</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">override</span> <span class="k">fun</span> <span class="nf">loadingFinished</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">viewState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nf">currentViewState</span><span class="p">().</span><span class="nf">copy</span><span class="p">(</span><span class="n">isLoading</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="the-copy-method">The copy() method</h2>
<p>To update one or more view state properties, the <code class="language-plaintext highlighter-rouge">ViewModel</code> grabs the current view state, as returned by <code class="language-plaintext highlighter-rouge">currentViewState()</code>, and uses the copy method to set a new value on one or more fields.</p>

<p>The copy method is provided as part of the Kotlin <code class="language-plaintext highlighter-rouge">data class</code>. When we use copy, all fields in the object remain as their original value unless you provide a new value.</p>

<p>It’s perfectly fine to define multiple fields that have changed in your view state as part of that copy method too, making it a convenient way of capturing changes. For example:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">viewState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nf">currentViewState</span><span class="p">().</span><span class="nf">copy</span><span class="p">(</span><span class="n">isEditing</span> <span class="p">=</span> <span class="n">hasFocus</span><span class="p">,</span> <span class="n">showClearButton</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
</code></pre></div></div>

<p>Because <code class="language-plaintext highlighter-rouge">viewState</code> is <code class="language-plaintext highlighter-rouge">LiveData</code>, any time a new value is set using <code class="language-plaintext highlighter-rouge">viewState.value</code> the Activity will immediately be notified that the UI state has changed and it will render the new UI.</p>

<h1 id="links">Links</h1>
<ul>
  <li>For more source code as a reference, you can check out the <a href="https://github.com/duckduckgo/Android">DuckDuckGo browser</a>, which is fully open source.</li>
</ul>


<a href='https://cdrussell.github.io//'>Home</a>


      </section>
    </div>
    <footer>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body>
</html>
