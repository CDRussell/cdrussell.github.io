<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Send Firebase FCM Push Notification from AWS Lambda | craigrussell</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Send Firebase FCM Push Notification from AWS Lambda" />
<meta name="author" content="Craig Russell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An example of how to configure an Amazon AWS Lambda to send a push notification to Firebase FCM, written with the Node.js 8.10 runtime." />
<meta property="og:description" content="An example of how to configure an Amazon AWS Lambda to send a push notification to Firebase FCM, written with the Node.js 8.10 runtime." />
<link rel="canonical" href="https://cdrussell.github.io//2019/03/send-firebase-fcm-push-notification-from-aws-lambda/" />
<meta property="og:url" content="https://cdrussell.github.io//2019/03/send-firebase-fcm-push-notification-from-aws-lambda/" />
<meta property="og:site_name" content="craigrussell" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-06T23:50:21+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Send Firebase FCM Push Notification from AWS Lambda" />
<script type="application/ld+json">
{"description":"An example of how to configure an Amazon AWS Lambda to send a push notification to Firebase FCM, written with the Node.js 8.10 runtime.","url":"https://cdrussell.github.io//2019/03/send-firebase-fcm-push-notification-from-aws-lambda/","@type":"BlogPosting","headline":"Send Firebase FCM Push Notification from AWS Lambda","dateModified":"2019-03-06T23:50:21+00:00","datePublished":"2019-03-06T23:50:21+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cdrussell.github.io//2019/03/send-firebase-fcm-push-notification-from-aws-lambda/"},"author":{"@type":"Person","name":"Craig Russell"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <header >
        <a href='https://cdrussell.github.io//'>
          <h1>craigrussell</h1>
          
            <p>Technical blog from Craig Russell.</p>
          
        </a>

        <nav>
  <div style="
         top: 0px;
         right: 0px;
         position: absolute">

    <a href="/about">
      <figure>
        <img src="/images/me-round.png"
             style="
              height: 50px;
              display: block;
              margin-left: auto;
              margin-right: auto;
              "
             alt="Photo of me, wearing a bright yellow t-shirt with a bright blue, cloudy sky in the background"
        />
        <figcaption style="text-align:justify" >About me</figcaption>
      </figure>
    </a>
  </div>
</nav>


        <p> </p>
      </header>
      <section>

      <p><em>This posts provides an example of how to configure an <code class="language-plaintext highlighter-rouge">Amazon AWS Lambda</code> to send a push notification to <code class="language-plaintext highlighter-rouge">Firebase FCM</code>, written with the <code class="language-plaintext highlighter-rouge">Node.js 8.10</code> runtime.</em></p>

<h2 id="what-is-aws-lambda">What is AWS Lambda</h2>
<p>This post assumes you are familiar with AWS Lambda already. If not, you can read more about it staight from <a href="https://aws.amazon.com/lambda/">the docs</a>.</p>

<h2 id="configure-the-lambda">Configure the lambda</h2>
<p>Create a new AWS lambda using the AWS Console. Configure these two options:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Runtime: Node.js 8.10
    Handler: index.handler

    // <span class="s1">'index'</span> refers to the file you are about to create
    // <span class="s1">'handler'</span> refers to the <span class="k">function </span>you are about to define
</code></pre></div></div>

<p>Create a single file called <code class="language-plaintext highlighter-rouge">index.js</code>, and in it, paste the following:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.js</span>

<span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="k">async</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
           <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fcm.googleapis.com</span><span class="dl">"</span><span class="p">,</span>
           <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/fcm/send</span><span class="dl">"</span><span class="p">,</span>
           <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
           <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
               <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">authorization</span><span class="p">,</span>
               <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span>
           <span class="p">}</span>
       <span class="p">};</span>
       
       <span class="kd">const</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">success</span><span class="dl">'</span><span class="p">)</span> <span class="p">;</span>
       <span class="p">});</span>
       
       <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
           <span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
       <span class="p">});</span>
       
       <span class="kd">const</span> <span class="nx">reqBody</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">{"to":"</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">deviceToken</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">", "priority" : "high"}</span><span class="dl">'</span>
       
       <span class="nx">req</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">reqBody</span><span class="p">);</span>
       <span class="nx">req</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="environment-variables">Environment Variables</h2>
<p>Note the two highlighted lines above: they both make use of <code class="language-plaintext highlighter-rouge">process.env</code> to access environment variables.</p>

<p>This means you’ll need to configure the following environment variables for the lamba to be authorized to send a Firebase push notification.</p>

<p><code class="language-plaintext highlighter-rouge">authorization</code></p>

<p><em>This is the authorization header you receive from your Firebase account console.</em></p>

<p>It will likely have the form <code class="language-plaintext highlighter-rouge">'key=ABCDEFG....'</code> and you need to ensure you keep the <code class="language-plaintext highlighter-rouge">key=</code> prefix.</p>

<p><code class="language-plaintext highlighter-rouge">deviceToken</code></p>

<p><em>This is the device token you receive from the device that will receive your Firebase push notification. You’ll receive this directly on the device as it registers for FCM.</em></p>

<h2 id="done">Done</h2>
<p>That’s it. You should be able to save that and hit the <code class="language-plaintext highlighter-rouge">test</code> button. When you do, your AWS Lambda will execute and send an HTTP POST request to Firebase FCM, triggering a push notification to your intended device.</p>


<a href='https://cdrussell.github.io//'>Home</a>


      </section>
    </div>
    <footer>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body>
</html>
